# Description:
# URL:
# Maintainer: CRUX System Team, core-ports at crux dot nu
# Arch Maintainer: CRUX-ARM System Team, devel at crux-arm dot nu
# Depends on: kernel-headers-arm-linux-gnu

name=libgmp-arm-linux-gnu
version=6.3.0
release=1
source=(https://ftp.gnu.org/gnu/gmp/gmp-$version.tar.xz \
        fix-armv4-flags.patch)

_target=arm-linux-gnu
_crosshost=$(echo $MACHTYPE | sed 's/-[^-]*/-cross/')

build() {
  patch -p0 -i $SRC/fix-armv4-flags.patch

  mkdir $SRC/build
  cd $SRC/build

  export CPPFLAGS="-fexceptions"

  ../gmp-$version/configure \
    --build=$_crosshost \
    --prefix=/usr/$_target

  make
  make DESTDIR=$PKG install

  rm -rf $PKG/usr/$_target/share

  #find $PKG -type f -name '*.la' | while read f; do
  #  sed -i "s|-L$SRC[^ ]* ||g" $f
  #done
}
